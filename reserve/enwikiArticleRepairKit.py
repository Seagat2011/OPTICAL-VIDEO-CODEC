#!/usr/bin/python

# Run AFTER enwikiFileRepairKit.py

import re

gfn = [
"enwiki00.js.00",
"enwiki01.js.00",
"enwiki02.js.00",
"enwiki03.js.00",
"enwiki04.js.00",
"enwiki05.js.00",
"enwiki06.js.00",
"enwiki07.js.00",
"enwiki08.js.00",
"enwiki09.js.00",
"enwiki10.js.00",
"enwiki11.js.00",
"enwiki12.js.00",
"enwiki13.js.00",
"enwiki14.js.00",
"enwiki15.js.00",
"enwiki16.js.00",
"enwiki17.js.00",
"enwiki18.js.00",
"enwiki19.js.00",
"enwiki20.js.00",
"enwiki21.js.00",
"enwiki22.js.00",
"enwiki23.js.00",
"enwiki24.js.00",
"enwiki25.js.00",
"enwiki26.js.00",
"enwiki27.js.00",
"enwiki28.js.00",
"enwiki29.js.00",
"enwiki30.js.00",
"enwiki31.js.00",
"enwiki32.js.00",
"enwiki33.js.00",
"enwiki34.js.00",
"enwiki35.js.00",
"enwiki36.js.00",
"enwiki37.js.00",
"enwiki38.js.00",
"enwiki39.js.00",
"enwiki40.js.00",
"enwiki41.js.00",
"enwiki42.js.00",
"enwiki43.js.00",
"enwiki44.js.00",
"enwiki45.js.00",
"enwiki46.js.00",
"enwiki47.js.00",
"enwiki48.js.00",
"enwiki49.js.00",
"enwiki50.js.00",
"enwiki51.js.00",
"enwiki52.js.00",
"enwiki53.js.00",
"enwiki54.js.00",
"enwiki55.js.00",
"enwiki56.js.00",
"enwiki57.js.00",
"enwiki58.js.00",
"enwiki59.js.00",
"enwiki60.js.00",
"enwiki61.js.00",
"enwiki62.js.00",
"enwiki63.js.00",
"enwiki64.js.00",
"enwiki65.js.00",
"enwiki66.js.00",
"enwiki67.js.00",
"enwiki68.js.00",
"enwiki69.js.00",
"enwiki70.js.00",
"enwiki71.js.00",
"enwiki72.js.00",
"enwiki73.js.00",
"enwiki74.js.00",
"enwiki75.js.00",
"enwiki76.js.00",
"enwiki77.js.00",
"enwiki78.js.00",
"enwiki79.js.00",
"enwiki80.js.00",
"enwiki81.js.00",
"enwiki82.js.00",
"enwiki83.js.00",
"enwiki84.js.00",
"enwiki85.js.00",
"enwiki86.js.00",
"enwiki87.js.00",
"enwiki88.js.00",
"enwiki89.js.00",
"enwiki9000.js.00",
"enwiki9001.js.00",
"enwiki9002.js.00",
"enwiki9003.js.00",
"enwiki9004.js.00",
"enwiki9005.js.00",
"enwiki9006.js.00",
"enwiki9007.js.00",
"enwiki9008.js.00",
"enwiki9009.js.00",
"enwiki9010.js.00",
"enwiki9011.js.00",
"enwiki9012.js.00",
"enwiki9013.js.00",
"enwiki9014.js.00",
"enwiki9015.js.00",
"enwiki9016.js.00",
"enwiki9017.js.00",
"enwiki9018.js.00",
"enwiki9019.js.00",
"enwiki9020.js.00",
"enwiki9021.js.00",
"enwiki9022.js.00",
"enwiki9023.js.00",
"enwiki9024.js.00",
"enwiki9025.js.00",
"enwiki9026.js.00",
"enwiki9027.js.00",
"enwiki9028.js.00",
"enwiki9029.js.00",
"enwiki9030.js.00",
"enwiki9031.js.00",
"enwiki9032.js.00",
"enwiki9033.js.00",
"enwiki9034.js.00",
"enwiki9035.js.00",
"enwiki9036.js.00",
"enwiki9037.js.00",
"enwiki9038.js.00",
"enwiki9039.js.00",
"enwiki9040.js.00",
"enwiki9041.js.00",
"enwiki9042.js.00",
"enwiki9043.js.00",
"enwiki9044.js.00",
"enwiki9045.js.00",
"enwiki9046.js.00",
"enwiki9047.js.00",
"enwiki9048.js.00",
"enwiki9049.js.00",
"enwiki9050.js.00",
"enwiki9051.js.00",
"enwiki9052.js.00",
"enwiki9053.js.00",
"enwiki9054.js.00",
"enwiki9055.js.00",
"enwiki9056.js.00",
"enwiki9057.js.00",
"enwiki9058.js.00",
"enwiki9059.js.00",
"enwiki9060.js.00",
"enwiki9061.js.00",
"enwiki9062.js.00",
"enwiki9063.js.00",
"enwiki9064.js.00",
"enwiki9065.js.00",
"enwiki9066.js.00",
"enwiki9067.js.00",
"enwiki9068.js.00",
"enwiki9069.js.00",
"enwiki9070.js.00",
"enwiki9071.js.00",
"enwiki9072.js.00",
"enwiki9073.js.00",
"enwiki9074.js.00",
"enwiki9075.js.00",
"enwiki9076.js.00",
"enwiki9077.js.00",
"enwiki9078.js.00",
"enwiki9079.js.00",
"enwiki9080.js.00",
"enwiki9081.js.00",
"enwiki9082.js.00",
"enwiki9083.js.00",
"enwiki9084.js.00",
"enwiki9085.js.00",
"enwiki9086.js.00",
"enwiki9087.js.00",
"enwiki9088.js.00",
"enwiki9089.js.00",
"enwiki9090.js.00",
"enwiki9091.js.00",
"enwiki9092.js.00",
"enwiki9093.js.00",
"enwiki9094.js.00",
"enwiki9095.js.00",
"enwiki9096.js.00",
"enwiki9097.js.00",
"enwiki9098.js.00",
"enwiki9099.js.00",
"enwiki9100.js.00",
"enwiki9101.js.00",
"enwiki9102.js.00",
"enwiki9103.js.00",
"enwiki9104.js.00",
"enwiki9105.js.00",
"enwiki9106.js.00",
"enwiki9107.js.00",
"enwiki9108.js.00",
"enwiki9109.js.00",
"enwiki9110.js.00",
"enwiki9111.js.00",
"enwiki9112.js.00",
"enwiki9113.js.00",
"enwiki9114.js.00",
"enwiki9115.js.00",
"enwiki9116.js.00",
"enwiki9117.js.00",
"enwiki9118.js.00",
"enwiki9119.js.00",
"enwiki9120.js.00",
"enwiki9121.js.00",
"enwiki9122.js.00",
"enwiki9123.js.00",
"enwiki9124.js.00",
"enwiki9125.js.00",
"enwiki9126.js.00",
"enwiki9127.js.00",
"enwiki9128.js.00",
"enwiki9129.js.00",
"enwiki9130.js.00",
"enwiki9131.js.00",
"enwiki9132.js.00",
"enwiki9133.js.00",
"enwiki9134.js.00",
"enwiki9135.js.00",
"enwiki9136.js.00",
"enwiki9137.js.00",
"enwiki9138.js.00",
"enwiki9139.js.00",
"enwiki9140.js.00",
"enwiki9141.js.00",
"enwiki9142.js.00",
"enwiki9143.js.00",
"enwiki9144.js.00",
"enwiki9145.js.00",
"enwiki9146.js.00",
"enwiki9147.js.00",
"enwiki9148.js.00",
"enwiki9149.js.00",
"enwiki9150.js.00",
"enwiki9151.js.00",
"enwiki9152.js.00",
"enwiki9153.js.00",
"enwiki9154.js.00",
"enwiki9155.js.00",
"enwiki9156.js.00",
"enwiki9157.js.00",
"enwiki9158.js.00",
"enwiki9159.js.00",
"enwiki9160.js.00",
"enwiki9161.js.00",
"enwiki9162.js.00",
"enwiki9163.js.00",
"enwiki9164.js.00",
"enwiki9165.js.00",
"enwiki9166.js.00",
"enwiki9167.js.00",
"enwiki9168.js.00",
"enwiki9169.js.00",
"enwiki9170.js.00",
"enwiki9171.js.00",
"enwiki9172.js.00",
"enwiki9173.js.00",
"enwiki9174.js.00",
"enwiki9175.js.00",
"enwiki9176.js.00",
"enwiki9177.js.00",
"enwiki9178.js.00",
"enwiki9179.js.00",
"enwiki9180.js.00",
"enwiki9181.js.00",
"enwiki9182.js.00",
"enwiki9183.js.00",
"enwiki9184.js.00",
"enwiki9185.js.00",
"enwiki9186.js.00",
"enwiki9187.js.00",
"enwiki9188.js.00",
"enwiki9189.js.00",
"enwiki9190.js.00",
"enwiki9191.js.00",
"enwiki9192.js.00",
"enwiki9193.js.00",
"enwiki9194.js.00",
"enwiki9195.js.00",
"enwiki9196.js.00",
"enwiki9197.js.00",
"enwiki9198.js.00",
"enwiki9199.js.00",
"enwiki9200.js.00",
"enwiki9201.js.00",
"enwiki9202.js.00",
"enwiki9203.js.00",
"enwiki9204.js.00",
"enwiki9205.js.00",
"enwiki9206.js.00",
"enwiki9207.js.00",
"enwiki9208.js.00",
"enwiki9209.js.00",
"enwiki9210.js.00",
"enwiki9211.js.00",
"enwiki9212.js.00",
"enwiki9213.js.00",
"enwiki9214.js.00",
"enwiki9215.js.00",
"enwiki9216.js.00",
"enwiki9217.js.00",
"enwiki9218.js.00",
"enwiki9219.js.00",
"enwiki9220.js.00",
"enwiki9221.js.00",
"enwiki9222.js.00",
"enwiki9223.js.00",
"enwiki9224.js.00",
"enwiki9225.js.00",
"enwiki9226.js.00",
"enwiki9227.js.00",
"enwiki9228.js.00",
"enwiki9229.js.00",
"enwiki9230.js.00",
"enwiki9231.js.00",
"enwiki9232.js.00",
"enwiki9233.js.00",
"enwiki9234.js.00",
"enwiki9235.js.00",
"enwiki9236.js.00",
"enwiki9237.js.00",
"enwiki9238.js.00",
"enwiki9239.js.00",
"enwiki9240.js.00",
"enwiki9241.js.00",
"enwiki9242.js.00",
"enwiki9243.js.00",
"enwiki9244.js.00",
"enwiki9245.js.00",
"enwiki9246.js.00",
"enwiki9247.js.00",
"enwiki9248.js.00",
"enwiki9249.js.00",
"enwiki9250.js.00",
"enwiki9251.js.00",
"enwiki9252.js.00",
"enwiki9253.js.00",
"enwiki9254.js.00",
"enwiki9255.js.00",
"enwiki9256.js.00",
"enwiki9257.js.00",
"enwiki9258.js.00",
"enwiki9259.js.00",
"enwiki9260.js.00",
"enwiki9261.js.00",
"enwiki9262.js.00",
"enwiki9263.js.00",
"enwiki9264.js.00",
"enwiki9265.js.00",
"enwiki9266.js.00",
"enwiki9267.js.00",
"enwiki9268.js.00",
"enwiki9269.js.00",
"enwiki9270.js.00",
"enwiki9271.js.00",
"enwiki9272.js.00",
"enwiki9273.js.00",
"enwiki9274.js.00",
"enwiki9275.js.00",
"enwiki9276.js.00",
"enwiki9277.js.00",
"enwiki9278.js.00",
"enwiki9279.js.00",
"enwiki9280.js.00",
"enwiki9281.js.00",
"enwiki9282.js.00",
"enwiki9283.js.00",
"enwiki9284.js.00",
"enwiki9285.js.00",
"enwiki9286.js.00",
"enwiki9287.js.00",
"enwiki9288.js.00",
"enwiki9289.js.00",
"enwiki9290.js.00",
"enwiki9291.js.00",
"enwiki9292.js.00",
"enwiki9293.js.00",
"enwiki9294.js.00",
"enwiki9295.js.00",
"enwiki9296.js.00",
"enwiki9297.js.00",
"enwiki9298.js.00",
"enwiki9299.js.00",
"enwiki9300.js.00",
"enwiki9301.js.00",
"enwiki9302.js.00",
"enwiki9303.js.00",
"enwiki9304.js.00",
"enwiki9305.js.00",
"enwiki9306.js.00",
"enwiki9307.js.00",
"enwiki9308.js.00",
"enwiki9309.js.00",
"enwiki9310.js.00",
"enwiki9311.js.00",
"enwiki9312.js.00",
"enwiki9313.js.00",
"enwiki9314.js.00",
"enwiki9315.js.00",
"enwiki9316.js.00",
"enwiki9317.js.00",
"enwiki9318.js.00",
"enwiki9319.js.00",
"enwiki9320.js.00",
"enwiki9321.js.00",
"enwiki9322.js.00",
"enwiki9323.js.00",
"enwiki9324.js.00",
"enwiki9325.js.00",
"enwiki9326.js.00",
"enwiki9327.js.00",
"enwiki9328.js.00",
"enwiki9329.js.00",
"enwiki9330.js.00",
"enwiki9331.js.00",
"enwiki9332.js.00",
"enwiki9333.js.00",
"enwiki9334.js.00",
"enwiki9335.js.00",
"enwiki9336.js.00",
"enwiki9337.js.00",
"enwiki9338.js.00",
"enwiki9339.js.00",
"enwiki9340.js.00",
"enwiki9341.js.00",
"enwiki9342.js.00",
"enwiki9343.js.00",
"enwiki9344.js.00",
"enwiki9345.js.00",
"enwiki9346.js.00",
"enwiki9347.js.00",
"enwiki9348.js.00",
"enwiki9349.js.00",
"enwiki9350.js.00",
"enwiki9351.js.00",
"enwiki9352.js.00",
"enwiki9353.js.00",
"enwiki9354.js.00",
"enwiki9355.js.00",
"enwiki9356.js.00",
"enwiki9357.js.00",
"enwiki9358.js.00",
"enwiki9359.js.00",
"enwiki9360.js.00",
"enwiki9361.js.00",
"enwiki9362.js.00",
"enwiki9363.js.00",
"enwiki9364.js.00",
"enwiki9365.js.00",
"enwiki9366.js.00",
"enwiki9367.js.00",
"enwiki9368.js.00",
"enwiki9369.js.00",
"enwiki9370.js.00",
"enwiki9371.js.00",
"enwiki9372.js.00",
"enwiki9373.js.00",
"enwiki9374.js.00",
"enwiki9375.js.00",
"enwiki9376.js.00",
"enwiki9377.js.00",
"enwiki9378.js.00",
"enwiki9379.js.00",
"enwiki9380.js.00",
"enwiki9381.js.00",
"enwiki9382.js.00",
"enwiki9383.js.00",
"enwiki9384.js.00",
"enwiki9385.js.00",
"enwiki9386.js.00",
"enwiki9387.js.00",
"enwiki9388.js.00",
"enwiki9389.js.00",
"enwiki9390.js.00",
"enwiki9391.js.00",
"enwiki9392.js.00",
"enwiki9393.js.00",
"enwiki9394.js.00",
"enwiki9395.js.00",
"enwiki9396.js.00",
"enwiki9397.js.00",
"enwiki9398.js.00",
"enwiki9399.js.00",
"enwiki9400.js.00",
"enwiki9401.js.00",
"enwiki9402.js.00",
"enwiki9403.js.00",
"enwiki9404.js.00",
"enwiki9405.js.00",
"enwiki9406.js.00",
"enwiki9407.js.00",
"enwiki9408.js.00",
"enwiki9409.js.00",
"enwiki9410.js.00",
"enwiki9411.js.00",
"enwiki9412.js.00",
"enwiki9413.js.00",
"enwiki9414.js.00",
]

class class_RepairEngine:
  __pttn_00 = re.compile(r"\A[\t\s]+\"article\":\[\{.*",re.I|re.S) # case-insensitive|wildcard-dot
  __pttn_01 = re.compile(r".*\}\],.*\Z",re.I|re.S) # case-insensitive|wildcard-dot
  __pttn_02 = re.compile("\n")
  createFile = False
  def repair(self,s): 
    return self.__pttn_02.sub("",s) 
  def test_closeTag(self,s):
    #print("close_tag")
    retval = False
    if self.__pttn_01.match(s):
      retval = True
      #print("close_tag_found %s"%s)
    return retval
  def test_openTag(self,s):
    #print("open_tag %s" %s)
    retval = False
    if self.__pttn_00.match(s):
      retval = True
      #print("open_tag_found %s"%s)
    return retval

repairEngine = class_RepairEngine()

str = ""

print("Working...")

for fn in gfn:
  ff = open(fn,"r")
  #print("%s"%fn)
  idx = 0
  __buffer = ["",]
  __openTag__ = \
  __closeTag__ = \
  __createFile__ = False
  __buffer[0] = ff.readline()
  while(1):  
    idx += 1    
    __buffer += [ff.readline()]
    #print("%s"%__buffer[idx]) 
    if __buffer[idx] != "":    
      if __openTag__ == False:
        __openTag__ = repairEngine.test_openTag(__buffer[idx-1])
      if __openTag__:
        __closeTag__ = repairEngine.test_closeTag(__buffer[idx-1])
        if not __closeTag__:
          if repairEngine.createFile == False:
            repairEngine.createFile = True
          __buffer[idx-1] = repairEngine.repair(__buffer[idx-1])
        else:
          __openTag__ = __closeTag__ = False
        # end test
      # end test
    else:    
      break
    # end test
  # end while    
  if repairEngine.createFile:
    repairEngine.createFile = False
    print("Repairing %s..." % fn)
    ff2 = open(fn+"-x","w")
    ff2.write( str.join(__buffer) )
    ff2.close()
  # end test
  ff.close()
# end loop fn  
  
print("Done.")
 